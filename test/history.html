<!-- Flat map next to text panel -->

<html>
  <head>
    <script src='https://unpkg.com/maplibre-gl@5.13.0/dist/maplibre-gl.js'></script>
    <script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
    <link href='https://unpkg.com/maplibre-gl@5.13.0/dist/maplibre-gl.css' rel='stylesheet' />
    <link href='style.css' rel='stylesheet' />
    <script src='./src/header.js'></script>

    <!-- Inject base URL into library -->
    <script src='./src/data.js'></script>

    <script src='../node_modules/rara-maps/build/bundle.js'></script>

    <script type="module">
      import { createToolbar } from "./src/toolbar.js";
      createToolbar('history');

      const map = raraMaps.historyCreateMap();

      import { Info } from "./src/info.js";
      const info = new Info( {
        map,
      } );

      import { Commentary } from './src/commentary.js';
      // Map from era to layer
      const eraToLayer = {
        c_1836_1838: 'camantsoc_1836_1838',
        c_1910: 'camantsoc_1910',
        c_1925: 'camantsoc_1925',
      };

      const commentary = new Commentary( {
        callback( oldId, newId ) {
          console.debug( `history.onUpdate id ${ oldId } -> ${ newId }` );

          const oldLayer = eraToLayer[ oldId ];
          const newLayer = eraToLayer[ newId ];

          console.debug(
            `history.onUpdate layer ${ oldLayer } -> ${ newLayer }`
          );

          map.appData.layers.getLayer( oldLayer ).visible = false;
          map.appData.layers.getLayer( newLayer ).visible = true;
        },
      } );

      function loaded( e ) {
        const layerId = eraToLayer[ commentary.ids[ 0 ] ];
        if ( e.isSourceLoaded && e.sourceId === layerId ) {
          console.debug( `Source ${ e.sourceId } is loaded` );
          commentary.setIndex( 0 );
          map.off( 'sourcedata', loaded );
        }
      }

      map.on( 'sourcedata', loaded );
    </script>
  </head>

  <body>
    <header id="foo" class="site-header">
      <div id="toolbar" class="toolbar"></div>
    </header>

    <div id="content" class="site-content">
      <div id="map" class="map"></div>

      <div class="nav">
        <div>
          <a class="prev-button">Back: <span class="prev-label"></span></a>
        </div>
        <div>
          <a class="next-button">Forward: <span class="next-label"></span></a>
        </div>
      </div>

      <nav id="menu" hidden=true></nav>

      <div id="commentary-panel">
        <div class="commentary" id="c_1836_1838">
          <h1>Circa 1836 - 1838</h1>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla dapibus finibus enim sit amet pharetra. Aenean odio mauris, pretium et fermentum eu, euismod ac lectus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Maecenas orci risus, blandit non odio sit amet, vulputate congue nisl. Etiam tempus placerat erat, ut blandit augue interdum sed. Duis vel libero metus. Praesent porttitor egestas leo vel volutpat. Integer ultricies elit quis suscipit dapibus. Proin varius et enim eget congue. Quisque tortor augue, vehicula id lorem a, tincidunt bibendum arcu. In hac habitasse platea dictumst. Morbi sit amet ipsum sed mi commodo finibus mattis in erat. Vestibulum dictum luctus malesuada. Maecenas pretium, diam at accumsan maximus, risus nisl blandit nunc, feugiat euismod orci nibh vitae purus. Aliquam dapibus sapien non tortor tincidunt, accumsan semper nulla pretium.</p>
          <p>Donec vestibulum diam et nisi condimentum, sed dictum odio faucibus. Aenean vitae vulputate ex. Pellentesque ultrices, dolor eget bibendum efficitur, magna orci viverra nunc, vel cursus nisl ipsum vel dolor. Aenean faucibus fringilla commodo. Donec tempor diam ipsum, in finibus arcu vestibulum in. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Maecenas congue leo orci, eget finibus elit auctor ut. Sed ultrices, risus eu finibus tincidunt, augue ipsum varius enim, ac rutrum ligula nibh sit amet magna. Pellentesque consectetur ante vitae neque faucibus ullamcorper. Proin ac nisi elit. Donec luctus enim vel risus commodo, sit amet blandit arcu venenatis. Integer condimentum fermentum purus, non tristique elit dapibus quis. Integer quam quam, finibus eget lectus in, molestie laoreet dolor. Sed sed sapien a est viverra laoreet. Suspendisse sodales scelerisque eros sit amet dapibus. Nullam id turpis sed arcu suscipit tincidunt.</p>
          <p>Vivamus metus mi, mattis quis interdum nec, laoreet sit amet est. Etiam leo ipsum, laoreet nec orci sed, ullamcorper viverra leo. Maecenas pharetra nisi lacus, quis luctus orci volutpat in. Fusce sodales volutpat scelerisque. Mauris ut urna neque. Praesent ultricies, ipsum at euismod tristique, lorem lorem accumsan quam, quis faucibus velit arcu ut purus. Maecenas elementum, sapien eu molestie sollicitudin, eros tortor euismod nulla, ac blandit nisl magna id justo. Etiam cursus mattis tempor.</p>
          <p>Aenean feugiat, velit ut eleifend fringilla, urna urna porta mi, sit amet hendrerit arcu elit id dui. Sed at nisl eget diam dictum placerat et vel massa. Fusce aliquet fringilla luctus. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Nullam vel sem ut ante dictum rhoncus. Nullam accumsan id orci vel venenatis. Nulla facilisi. Nulla ut lobortis massa, non porttitor lacus. Maecenas vel nibh luctus, vehicula justo commodo, mollis massa. In erat quam, congue aliquam aliquam et, commodo eu lacus. Curabitur suscipit aliquet diam ac congue. Etiam volutpat massa eget molestie pharetra.</p>
          <p>Maecenas tincidunt finibus condimentum. Cras tristique nibh non bibendum pharetra. Ut vel orci finibus, bibendum diam at, pellentesque neque. Praesent auctor tempus hendrerit. Phasellus ac lacus consequat, volutpat elit non, condimentum ligula. Phasellus sodales felis in finibus volutpat. Nam iaculis eu mi nec hendrerit. Duis maximus iaculis velit nec feugiat. Interdum et malesuada fames ac ante ipsum primis in faucibus. Fusce fringilla nisl est, eget luctus odio lacinia vitae. Vestibulum lectus dolor, tincidunt sit amet hendrerit non, sodales nec lectus. Phasellus pharetra porta vehicula. Nunc dui urna, suscipit eget est non, convallis aliquam lectus. Sed viverra elit arcu, nec posuere elit ornare vitae.</p>
        </div>
        <div class="commentary" id="c_1910">
          <h1>Circa 1910</h1>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla dapibus finibus enim sit amet pharetra. Aenean odio mauris, pretium et fermentum eu, euismod ac lectus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Maecenas orci risus, blandit non odio sit amet, vulputate congue nisl. Etiam tempus placerat erat, ut blandit augue interdum sed. Duis vel libero metus. Praesent porttitor egestas leo vel volutpat. Integer ultricies elit quis suscipit dapibus. Proin varius et enim eget congue. Quisque tortor augue, vehicula id lorem a, tincidunt bibendum arcu. In hac habitasse platea dictumst. Morbi sit amet ipsum sed mi commodo finibus mattis in erat. Vestibulum dictum luctus malesuada. Maecenas pretium, diam at accumsan maximus, risus nisl blandit nunc, feugiat euismod orci nibh vitae purus. Aliquam dapibus sapien non tortor tincidunt, accumsan semper nulla pretium.</p>
          <p>Donec vestibulum diam et nisi condimentum, sed dictum odio faucibus. Aenean vitae vulputate ex. Pellentesque ultrices, dolor eget bibendum efficitur, magna orci viverra nunc, vel cursus nisl ipsum vel dolor. Aenean faucibus fringilla commodo. Donec tempor diam ipsum, in finibus arcu vestibulum in. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Maecenas congue leo orci, eget finibus elit auctor ut. Sed ultrices, risus eu finibus tincidunt, augue ipsum varius enim, ac rutrum ligula nibh sit amet magna. Pellentesque consectetur ante vitae neque faucibus ullamcorper. Proin ac nisi elit. Donec luctus enim vel risus commodo, sit amet blandit arcu venenatis. Integer condimentum fermentum purus, non tristique elit dapibus quis. Integer quam quam, finibus eget lectus in, molestie laoreet dolor. Sed sed sapien a est viverra laoreet. Suspendisse sodales scelerisque eros sit amet dapibus. Nullam id turpis sed arcu suscipit tincidunt.</p>
          <p>Vivamus metus mi, mattis quis interdum nec, laoreet sit amet est. Etiam leo ipsum, laoreet nec orci sed, ullamcorper viverra leo. Maecenas pharetra nisi lacus, quis luctus orci volutpat in. Fusce sodales volutpat scelerisque. Mauris ut urna neque. Praesent ultricies, ipsum at euismod tristique, lorem lorem accumsan quam, quis faucibus velit arcu ut purus. Maecenas elementum, sapien eu molestie sollicitudin, eros tortor euismod nulla, ac blandit nisl magna id justo. Etiam cursus mattis tempor.</p>
          <p>Aenean feugiat, velit ut eleifend fringilla, urna urna porta mi, sit amet hendrerit arcu elit id dui. Sed at nisl eget diam dictum placerat et vel massa. Fusce aliquet fringilla luctus. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Nullam vel sem ut ante dictum rhoncus. Nullam accumsan id orci vel venenatis. Nulla facilisi. Nulla ut lobortis massa, non porttitor lacus. Maecenas vel nibh luctus, vehicula justo commodo, mollis massa. In erat quam, congue aliquam aliquam et, commodo eu lacus. Curabitur suscipit aliquet diam ac congue. Etiam volutpat massa eget molestie pharetra.</p>
          <p>Maecenas tincidunt finibus condimentum. Cras tristique nibh non bibendum pharetra. Ut vel orci finibus, bibendum diam at, pellentesque neque. Praesent auctor tempus hendrerit. Phasellus ac lacus consequat, volutpat elit non, condimentum ligula. Phasellus sodales felis in finibus volutpat. Nam iaculis eu mi nec hendrerit. Duis maximus iaculis velit nec feugiat. Interdum et malesuada fames ac ante ipsum primis in faucibus. Fusce fringilla nisl est, eget luctus odio lacinia vitae. Vestibulum lectus dolor, tincidunt sit amet hendrerit non, sodales nec lectus. Phasellus pharetra porta vehicula. Nunc dui urna, suscipit eget est non, convallis aliquam lectus. Sed viverra elit arcu, nec posuere elit ornare vitae.</p>
        </div>
        <div class="commentary" id="c_1925">
          <h1>Circa 1925</h1>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla dapibus finibus enim sit amet pharetra. Aenean odio mauris, pretium et fermentum eu, euismod ac lectus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Maecenas orci risus, blandit non odio sit amet, vulputate congue nisl. Etiam tempus placerat erat, ut blandit augue interdum sed. Duis vel libero metus. Praesent porttitor egestas leo vel volutpat. Integer ultricies elit quis suscipit dapibus. Proin varius et enim eget congue. Quisque tortor augue, vehicula id lorem a, tincidunt bibendum arcu. In hac habitasse platea dictumst. Morbi sit amet ipsum sed mi commodo finibus mattis in erat. Vestibulum dictum luctus malesuada. Maecenas pretium, diam at accumsan maximus, risus nisl blandit nunc, feugiat euismod orci nibh vitae purus. Aliquam dapibus sapien non tortor tincidunt, accumsan semper nulla pretium.</p>
          <p>Donec vestibulum diam et nisi condimentum, sed dictum odio faucibus. Aenean vitae vulputate ex. Pellentesque ultrices, dolor eget bibendum efficitur, magna orci viverra nunc, vel cursus nisl ipsum vel dolor. Aenean faucibus fringilla commodo. Donec tempor diam ipsum, in finibus arcu vestibulum in. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Maecenas congue leo orci, eget finibus elit auctor ut. Sed ultrices, risus eu finibus tincidunt, augue ipsum varius enim, ac rutrum ligula nibh sit amet magna. Pellentesque consectetur ante vitae neque faucibus ullamcorper. Proin ac nisi elit. Donec luctus enim vel risus commodo, sit amet blandit arcu venenatis. Integer condimentum fermentum purus, non tristique elit dapibus quis. Integer quam quam, finibus eget lectus in, molestie laoreet dolor. Sed sed sapien a est viverra laoreet. Suspendisse sodales scelerisque eros sit amet dapibus. Nullam id turpis sed arcu suscipit tincidunt.</p>
          <p>Vivamus metus mi, mattis quis interdum nec, laoreet sit amet est. Etiam leo ipsum, laoreet nec orci sed, ullamcorper viverra leo. Maecenas pharetra nisi lacus, quis luctus orci volutpat in. Fusce sodales volutpat scelerisque. Mauris ut urna neque. Praesent ultricies, ipsum at euismod tristique, lorem lorem accumsan quam, quis faucibus velit arcu ut purus. Maecenas elementum, sapien eu molestie sollicitudin, eros tortor euismod nulla, ac blandit nisl magna id justo. Etiam cursus mattis tempor.</p>
          <p>Aenean feugiat, velit ut eleifend fringilla, urna urna porta mi, sit amet hendrerit arcu elit id dui. Sed at nisl eget diam dictum placerat et vel massa. Fusce aliquet fringilla luctus. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Nullam vel sem ut ante dictum rhoncus. Nullam accumsan id orci vel venenatis. Nulla facilisi. Nulla ut lobortis massa, non porttitor lacus. Maecenas vel nibh luctus, vehicula justo commodo, mollis massa. In erat quam, congue aliquam aliquam et, commodo eu lacus. Curabitur suscipit aliquet diam ac congue. Etiam volutpat massa eget molestie pharetra.</p>
          <p>Maecenas tincidunt finibus condimentum. Cras tristique nibh non bibendum pharetra. Ut vel orci finibus, bibendum diam at, pellentesque neque. Praesent auctor tempus hendrerit. Phasellus ac lacus consequat, volutpat elit non, condimentum ligula. Phasellus sodales felis in finibus volutpat. Nam iaculis eu mi nec hendrerit. Duis maximus iaculis velit nec feugiat. Interdum et malesuada fames ac ante ipsum primis in faucibus. Fusce fringilla nisl est, eget luctus odio lacinia vitae. Vestibulum lectus dolor, tincidunt sit amet hendrerit non, sodales nec lectus. Phasellus pharetra porta vehicula. Nunc dui urna, suscipit eget est non, convallis aliquam lectus. Sed viverra elit arcu, nec posuere elit ornare vitae.</p>
        </div>
      </div>
    </div>

    <footer class="site-footer"></footer>

    <pre id="info" style="display: none;"></pre>
  </body>
</html>
